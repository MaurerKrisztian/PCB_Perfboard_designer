var C=Object.defineProperty;var O=(t,n,s)=>n in t?C(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var f=(t,n,s)=>(O(t,typeof n!="symbol"?n+"":n,s),s);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerpolicy&&(c.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?c.credentials="include":i.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(i){if(i.ep)return;i.ep=!0;const c=s(i);fetch(i.href,c)}})();class d{static getSafeHtmlElement(n){const s=document.getElementById(n);if(s==null)throw new Error(`Element: ${n} not found.`);return s}}const D=class{};let o=D;f(o,"c",d.getSafeHtmlElement("myCanvas")),f(o,"ctx",D.c.getContext("2d"));d.getSafeHtmlElement("downloadBtn").addEventListener("click",function(){const t=document.createElement("a");t.download="canvas.png",t.href=o.c.toDataURL(),t.click()});class e{}f(e,"dotRadius",5),f(e,"dots",[]),f(e,"selectedDot"),f(e,"hoverDot"),f(e,"lines",[]),f(e,"selectedLine"),f(e,"hoverLine"),f(e,"changes",[]),f(e,"changeIndex",-1),f(e,"canvasBackgroundColor","#046307");const T=d.getSafeHtmlElement("saveProgressBtn");T.addEventListener("click",function(){localStorage.setItem("canvasDots",JSON.stringify(e.dots)),localStorage.setItem("canvasLines",JSON.stringify(e.lines)),alert("Project saved to local storage.")});const N=d.getSafeHtmlElement("saveProjectBtn");N.addEventListener("click",function(){const t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({dots:e.dots,lines:e.lines,canvas:{width:o.c.width,height:o.c.height}})),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","canvas_project.json"),document.body.appendChild(n),n.click(),n.remove()});function x(){o.ctx.fillStyle=e.canvasBackgroundColor,o.ctx.clearRect(0,0,o.c.width,o.c.height),o.ctx.fillRect(0,0,o.c.width,o.c.height),o.ctx.fill()}function j(t){o.ctx.beginPath(),o.ctx.arc(t.x,t.y,e.dotRadius,0,Math.PI*2),o.ctx.fillStyle=t.color,o.ctx.fill(),t==e.selectedDot&&(o.ctx.strokeStyle="#00f",o.ctx.lineWidth=3,o.ctx.stroke()),t.description&&(o.ctx.font="10px Arial",o.ctx.textAlign="center",o.ctx.fillStyle=t.color,o.ctx.fillText(t.description.substring(0,5),t.x,t.y+e.dotRadius+10))}function A(t){o.ctx.beginPath(),o.ctx.moveTo(t.start.x,t.start.y),o.ctx.lineTo(t.end.x,t.end.y),o.ctx.strokeStyle=t.color,o.ctx.lineWidth=t==e.selectedLine?5:t==e.hoverLine?4:3,o.ctx.stroke()}function r(){x();for(let t=0;t<e.dots.length;t++)j(e.dots[t]);for(let t=0;t<e.lines.length;t++)A(e.lines[t])}o.c.addEventListener("mousedown",function(t){q(o.c,t)});function q(t,n){const s=t.getBoundingClientRect(),a=n.clientX-s.left,i=n.clientY-s.top;for(let c=0;c<e.dots.length;c++){const l=e.dots[c],h=a-l.x,u=i-l.y;if(h*h+u*u<e.dotRadius*e.dotRadius){if(e.selectedDot&&e.selectedDot!=l){const g={start:e.selectedDot,end:l,color:"#777676"};e.lines.push(g),e.changes.splice(e.changeIndex+1),e.changes.push({type:"add",line:g}),e.changeIndex++,e.selectedDot=void 0,e.selectedLine=g,r()}else e.selectedDot=l,e.selectedLine=void 0,r();return}}for(let c=0;c<e.lines.length;c++){const l=e.lines[c],h=l.start.x-a,u=l.start.y-i,g=l.end.x-a,p=l.end.y-i,v=Math.sqrt(h*h+u*u),y=Math.sqrt(g*g+p*p),R=Math.sqrt(Math.pow(l.end.x-l.start.x,2)+Math.pow(l.end.y-l.start.y,2));if(Math.abs(R-(v+y))<5){e.selectedLine=l,e.selectedDot=void 0,r();return}}e.selectedDot=void 0,e.selectedLine=void 0,r()}const S=d.getSafeHtmlElement("loadProjectBtn"),J=d.getSafeHtmlElement("loadProjectTrigger");J.addEventListener("click",function(){S.click()});S.addEventListener("change",function(t){const n=t.target.files[0];if(!n)return;const s=new FileReader;s.onload=function(a){const i=a.target.result,c=JSON.parse(i);o.c.width=c.canvas.width,o.c.height=c.canvas.height,e.dots=c.dots,e.lines=c.lines,r()},s.readAsText(n)});o.c.addEventListener("mousemove",function(t){const n=o.c.getBoundingClientRect(),s=t.clientX-n.left,a=t.clientY-n.top;e.hoverDot=void 0;for(let i=0;i<e.dots.length;i++){const c=e.dots[i],l=s-c.x,h=a-c.y;if(l*l+h*h<e.dotRadius*e.dotRadius){e.hoverDot=c;break}}e.hoverLine=void 0;for(let i=0;i<e.lines.length;i++){const c=e.lines[i],l=c.start.x-s,h=c.start.y-a,u=c.end.x-s,g=c.end.y-a,p=Math.sqrt(l*l+h*h),v=Math.sqrt(u*u+g*g),y=Math.sqrt(Math.pow(c.end.x-c.start.x,2)+Math.pow(c.end.y-c.start.y,2));if(Math.abs(y-(p+v))<10){e.hoverLine=c;break}}r(),e.hoverDot&&e.hoverDot.description?d.getSafeHtmlElement("dotDescription").innerText=e.hoverDot.description:d.getSafeHtmlElement("dotDescription").innerText=""});window.addEventListener("keypress",t=>{console.log(t);for(const n of m.sohortcuts)t.key==n.key&&n.event(t)});class m{static add(n){this.sohortcuts.find(s=>n.key==s.key)!==void 0&&console.warn(`Shortcut key: ${n.key} already exists`),this.sohortcuts.push(n),this.show()}static show(){d.getSafeHtmlElement("shortcuts").innerHTML="<b>Shortcuts:</b> <br>"+this.sohortcuts.map(n=>`key: <b>${n.ctrl?"ctrl + ":""} ${n.key} </b> - ${n.description}`).join("<br>")}}f(m,"sohortcuts",[]);d.getSafeHtmlElement("addDescriptionBtn").addEventListener("click",function(){w()});d.getSafeHtmlElement("deleteDescriptionBtn").addEventListener("click",function(){I()});function w(){if(e.selectedDot){const t=prompt("Enter a description for the dot");e.selectedDot.description=t,e.selectedDot=void 0,r()}else alert("Please select a dot first by clicking on it")}function I(){e.selectedDot?(e.selectedDot.description=null,r()):alert("Please select a dot first by clicking on it")}m.add({key:"d",event:w,description:"Add description."});m.add({key:"D",event:I,description:"Remove description."});d.getSafeHtmlElement("changeDotColorBtn").addEventListener("click",function(){H()});function H(){!e.selectedDot||(d.getSafeHtmlElement("colorPicker").onchange=function(){e.selectedDot&&(e.selectedDot.color=this.value,r())},d.getSafeHtmlElement("colorPicker").click())}d.getSafeHtmlElement("changeLineColorBtn").addEventListener("click",function(){b()});d.getSafeHtmlElement("deleteLineBtn").addEventListener("click",function(){B()});function b(){!e.selectedLine||(d.getSafeHtmlElement("colorPicker").onchange=function(){e.selectedLine&&(e.selectedLine.color=this.value,r())},d.getSafeHtmlElement("colorPicker").click())}function B(){if(e.selectedLine){const t=e.lines.indexOf(e.selectedLine);t>-1&&(e.changes.splice(e.changeIndex+1),e.changes.push({type:"remove",line:e.selectedLine}),e.changeIndex++,e.lines.splice(t,1),e.selectedLine=void 0,r())}else alert("Please select a line first by clicking on it")}m.add({key:"Delete",event:B,description:"Delete line."});m.add({key:"c",event:()=>{b(),H()},description:"Change dot/line color."});d.getSafeHtmlElement("backBtn").addEventListener("click",function(){M()});function M(){if(e.changeIndex>=0){const t=e.changes[e.changeIndex];if(t.type=="add"){for(let n=0;n<e.lines.length;n++)if(e.lines[n].start==t.line.start&&e.lines[n].end==t.line.end){e.lines.splice(n,1);break}}else t.type=="remove"&&e.lines.push(t.line);e.changeIndex--,r()}}d.getSafeHtmlElement("forwardBtn").addEventListener("click",function(){P()});function P(){if(e.changeIndex<e.changes.length-1){e.changeIndex++;const t=e.changes[e.changeIndex];if(t==null)return;if(t.type=="add")e.lines.push(t.line);else if(t.type=="remove"){for(let n=0;n<e.lines.length;n++)if(e.lines[n].start==t.line.start&&e.lines[n].end==t.line.end){e.lines.splice(n,1);break}}r()}}m.add({key:"z",ctrl:!0,description:"Undo last change.",event:M});m.add({key:"y",ctrl:!0,description:"Redo last undo.",event:P});window.addEventListener("DOMContentLoaded",()=>{if(localStorage.getItem("canvasDots")!==null&&localStorage.getItem("canvasLines")!==null){const t=localStorage.getItem("canvasDots"),n=localStorage.getItem("canvasLines");t&&n&&(e.dots=JSON.parse(t),e.lines=JSON.parse(n)),r()}});const k=d.getSafeHtmlElement("dotMatrixWidth"),L=d.getSafeHtmlElement("dotMatrixHeight"),$=d.getSafeHtmlElement("resizeGridBtn");$.addEventListener("click",function(){const t=parseInt(k.value),n=parseInt(L.value);E(t,n),e.lines=[],r()});function E(t,n){o.c.width=t*50,o.c.height=n*50;const s=o.c.width/t,a=o.c.height/n;e.dots=[];for(let i=s/2;i<o.c.width;i+=s)for(let c=a/2;c<o.c.height;c+=a)e.dots.push({x:i,y:c,description:null,color:"#a4a0a0"})}d.getSafeHtmlElement("resetBtn").addEventListener("click",function(){e.lines=[],e.dots=[],E(parseInt(k.value||"10"),parseInt(L.value||"10")),x(),r()});E(parseInt(k.value||"10"),parseInt(L.value||"10"));x();r();
