var H=Object.defineProperty;var M=(t,n,l)=>n in t?H(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l;var d=(t,n,l)=>(M(t,typeof n!="symbol"?n+"":n,l),l);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const s of c)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function l(c){const s={};return c.integrity&&(s.integrity=c.integrity),c.referrerpolicy&&(s.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?s.credentials="include":c.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(c){if(c.ep)return;c.ep=!0;const s=l(c);fetch(c.href,s)}})();class o{static getSafeHtmlElement(n){const l=document.getElementById(n);if(l==null)throw new Error(`Element: ${n} not found.`);return l}}const y=class{};let i=y;d(i,"c",o.getSafeHtmlElement("myCanvas")),d(i,"ctx",y.c.getContext("2d"));o.getSafeHtmlElement("downloadBtn").addEventListener("click",function(){const t=document.createElement("a");t.download="canvas.png",t.href=i.c.toDataURL(),t.click()});class e{}d(e,"dotRadius",5),d(e,"dots",[]),d(e,"lines",[]),d(e,"selectedDot"),d(e,"selectedLine"),d(e,"hoverLine"),d(e,"changes",[]),d(e,"changeIndex",-1),d(e,"hoverDot"),d(e,"canvasBackgroundColor","#046307");const P=o.getSafeHtmlElement("saveProgressBtn");P.addEventListener("click",function(){localStorage.setItem("canvasDots",JSON.stringify(e.dots)),localStorage.setItem("canvasLines",JSON.stringify(e.lines)),alert("Project saved to local storage.")});const R=o.getSafeHtmlElement("saveProjectBtn");R.addEventListener("click",function(){const t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({dots:e.dots,lines:e.lines})),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","canvas_project.json"),document.body.appendChild(n),n.click(),n.remove()});function L(){i.ctx.fillStyle=e.canvasBackgroundColor,i.ctx.clearRect(0,0,i.c.width,i.c.height),i.ctx.fillRect(0,0,i.c.width,i.c.height),i.ctx.fill()}function O(t){i.ctx.beginPath(),i.ctx.arc(t.x,t.y,e.dotRadius,0,Math.PI*2),i.ctx.fillStyle=t.color,i.ctx.fill(),t==e.selectedDot&&(i.ctx.strokeStyle="#00f",i.ctx.lineWidth=3,i.ctx.stroke()),t.description&&(i.ctx.font="10px Arial",i.ctx.textAlign="center",i.ctx.fillStyle=t.color,i.ctx.fillText(t.description.substring(0,5),t.x,t.y+e.dotRadius+10))}function N(t){i.ctx.beginPath(),i.ctx.moveTo(t.start.x,t.start.y),i.ctx.lineTo(t.end.x,t.end.y),i.ctx.strokeStyle=t.color,i.ctx.lineWidth=t==e.selectedLine?5:t==e.hoverLine?4:3,i.ctx.stroke()}function a(){L();for(let t=0;t<e.dots.length;t++)O(e.dots[t]);for(let t=0;t<e.lines.length;t++)N(e.lines[t])}i.c.addEventListener("mousedown",function(t){C(i.c,t)});function C(t,n){const l=t.getBoundingClientRect(),r=n.clientX-l.left,c=n.clientY-l.top;for(let h=0;h<e.dots.length;h++){var s=e.dots[h],f=r-s.x,g=c-s.y;if(f*f+g*g<e.dotRadius*e.dotRadius){if(e.selectedDot&&e.selectedDot!=s){var m={start:e.selectedDot,end:s,color:"#777676"};e.lines.push(m),e.changes.splice(e.changeIndex+1),e.changes.push({type:"add",line:m}),e.changeIndex++,e.selectedDot=null,e.selectedLine=m,a()}else e.selectedDot=s,e.selectedLine=null,a();return}}for(let h=0;h<e.lines.length;h++){var u=e.lines[h],v=u.start.x-r,p=u.start.y-c,x=u.end.x-r,E=u.end.y-c,w=Math.sqrt(v*v+p*p),B=Math.sqrt(x*x+E*E),b=Math.sqrt(Math.pow(u.end.x-u.start.x,2)+Math.pow(u.end.y-u.start.y,2));if(Math.abs(b-(w+B))<5){e.selectedLine=u,e.selectedDot=null,a();return}}e.selectedDot=null,e.selectedLine=null,a()}const k=o.getSafeHtmlElement("loadProjectBtn"),T=o.getSafeHtmlElement("loadProjectTrigger");T.addEventListener("click",function(){k.click()});k.addEventListener("change",function(t){var n=t.target.files[0];if(!!n){var l=new FileReader;l.onload=function(r){var c=r.target.result,s=JSON.parse(c);e.dots=s.dots,e.lines=s.lines,a()},l.readAsText(n)}});i.c.addEventListener("mousemove",function(t){const n=i.c.getBoundingClientRect(),l=t.clientX-n.left,r=t.clientY-n.top;e.hoverDot=null;for(let c=0;c<e.dots.length;c++){const s=e.dots[c],f=l-s.x,g=r-s.y;if(f*f+g*g<e.dotRadius*e.dotRadius){e.hoverDot=s;break}}e.hoverLine=null;for(let c=0;c<e.lines.length;c++){const s=e.lines[c],f=s.start.x-l,g=s.start.y-r,m=s.end.x-l,u=s.end.y-r,v=Math.sqrt(f*f+g*g),p=Math.sqrt(m*m+u*u),x=Math.sqrt(Math.pow(s.end.x-s.start.x,2)+Math.pow(s.end.y-s.start.y,2));if(Math.abs(x-(v+p))<10){e.hoverLine=s;break}}a(),e.hoverDot&&e.hoverDot.description?o.getSafeHtmlElement("dotDescription").innerText=e.hoverDot.description:o.getSafeHtmlElement("dotDescription").innerText=""});o.getSafeHtmlElement("addDescriptionBtn").addEventListener("click",function(){if(e.selectedDot){const t=prompt("Enter a description for the dot");e.selectedDot.description=t,e.selectedDot=null,a()}else alert("Please select a dot first by clicking on it")});o.getSafeHtmlElement("deleteDescriptionBtn").addEventListener("click",function(){e.selectedDot?(e.selectedDot.description=null,a()):alert("Please select a dot first by clicking on it")});o.getSafeHtmlElement("changeLineColorBtn").addEventListener("click",function(){o.getSafeHtmlElement("colorPicker").onchange=function(){e.selectedLine&&(e.selectedLine.color=this.value,a())},o.getSafeHtmlElement("colorPicker").click()});o.getSafeHtmlElement("deleteLineBtn").addEventListener("click",function(){if(e.selectedLine){const t=e.lines.indexOf(e.selectedLine);t>-1&&(e.changes.splice(e.changeIndex+1),e.changes.push({type:"remove",line:e.selectedLine}),e.changeIndex++,e.lines.splice(t,1),e.selectedLine=null,a())}else alert("Please select a line first by clicking on it")});document.getElementById("backBtn").addEventListener("click",function(){if(e.changeIndex>=0){var t=e.changes[e.changeIndex];if(t.type=="add"){for(let n=0;n<e.lines.length;n++)if(e.lines[n].start==t.line.start&&e.lines[n].end==t.line.end){e.lines.splice(n,1);break}}else t.type=="remove"&&e.lines.push(t.line);e.changeIndex--,a()}});document.getElementById("forwardBtn").addEventListener("click",function(){if(e.changeIndex<e.changes.length-1){e.changeIndex++;var t=e.changes[e.changeIndex];if(t.type=="add")e.lines.push(t.line);else if(t.type=="remove"){for(let n=0;n<e.lines.length;n++)if(e.lines[n].start==t.line.start&&e.lines[n].end==t.line.end){e.lines.splice(n,1);break}}a()}});window.addEventListener("DOMContentLoaded",()=>{if(localStorage.getItem("canvasDots")!==null&&localStorage.getItem("canvasLines")!==null){const t=localStorage.getItem("canvasDots"),n=localStorage.getItem("canvasLines");t&&n&&(e.dots=JSON.parse(t),e.lines=JSON.parse(n)),a()}});const D=o.getSafeHtmlElement("dotMatrixWidth"),S=o.getSafeHtmlElement("dotMatrixHeight"),j=o.getSafeHtmlElement("resizeGridBtn");j.addEventListener("click",function(){const t=parseInt(D.value),n=parseInt(S.value);I(t,n),e.lines=[],a()});function I(t,n){let l=i.c.width/t,r=i.c.height/n;e.dots=[];for(let c=l/2;c<i.c.width;c+=l)for(let s=r/2;s<i.c.height;s+=r)e.dots.push({x:c,y:s,description:null,color:"#a4a0a0"})}I(parseInt(D.value||"10"),parseInt(S.value||"10"));L();a();
