var j=Object.defineProperty;var q=(t,n,o)=>n in t?j(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;var h=(t,n,o)=>(q(t,typeof n!="symbol"?n+"":n,o),o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const s of c)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(c){const s={};return c.integrity&&(s.integrity=c.integrity),c.referrerpolicy&&(s.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?s.credentials="include":c.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(c){if(c.ep)return;c.ep=!0;const s=o(c);fetch(c.href,s)}})();class a{static getSafeHtmlElement(n){const o=document.getElementById(n);if(o==null)throw new Error(`Element: ${n} not found.`);return o}}const P=class{};let i=P;h(i,"c",a.getSafeHtmlElement("myCanvas")),h(i,"ctx",P.c.getContext("2d"));a.getSafeHtmlElement("downloadBtn").addEventListener("click",function(){const t=document.createElement("a");t.download="canvas.png",t.href=i.c.toDataURL(),t.click()});const y=class{};let e=y;h(e,"dotRadius",5),h(e,"dots",[]),h(e,"selectedDot"),h(e,"hoverDot"),h(e,"lines",[]),h(e,"selectedLine"),h(e,"hoverLine"),h(e,"changes",[]),h(e,"changeIndex",-1),h(e,"selectedIc"),h(e,"extraSelectionRatio",4),h(e,"dotSelectionRadius",y.dotRadius*y.extraSelectionRatio),h(e,"lineSelectTolerance",5),h(e,"canvasBackgroundColor","#046307");const C=class{constructor(n,o,r,c){h(this,"id",Math.random()*100);h(this,"topLeftDot",null);this.widthPin=n,this.heightPin=o,this.pinDescription=r,this.name=c}static add(n){this.IC_CONTAINER.push(n),this.showICs()}static showICs(){a.getSafeHtmlElement("ic-items").innerHTML=C.IC_CONTAINER.map(n=>`<button onclick='selectIc(${n.id})'> ${n.name}</button>, `).join(" ")}updatePosition(n,o){const r=50*(this.widthPin-1),c=50*(this.heightPin-1),s=n-r/2,l=o-c/2;let f=null,g=null;for(const p of e.dots){const x=this.calculateDistance(p.x,p.y,s,l);f==null&&(f=x),x<f&&(f=x,g=p)}this.topLeftDot=g}draw(){var r,c;if(!this.topLeftDot)return;i.ctx.beginPath(),i.ctx.fillStyle="rgba(49,45,45,0.62)";const n=50*(this.widthPin-1),o=50*(this.heightPin-1);i.ctx.rect((r=this.topLeftDot)==null?void 0:r.x,(c=this.topLeftDot)==null?void 0:c.y,n,o),i.ctx.stroke(),i.ctx.fill()}getPinPositionOnIC(n){if(this.topLeftDot==null)return!1;const o=n.x==this.topLeftDot.x&&n.y>=this.topLeftDot.y&&n.y<=this.topLeftDot.y+(this.heightPin-1)*50,r=n.x==this.topLeftDot.x+50*(this.widthPin-1)&&n.y>=this.topLeftDot.y&&n.y<=this.topLeftDot.y+(this.heightPin-1)*50;if(!(o||r))return null;(this.heightPin-1)*50;const c=n.y-this.topLeftDot.y,s=Math.floor(c/50)+1;if(s>0&&s<=this.heightPin){if(r){console.log("rightttttt",s,s+this.heightPin);const l=this.heightPin*2-s+1;return{pin:l,info:this.pinDescription[l]}}return console.log(this.pinDescription),{pin:s,info:this.pinDescription[s]}}}getPinNumber(n){if(!this.getPinPositionOnIC(n)||!this.topLeftDot)return null;const o=n.y-this.topLeftDot.y,r=Math.floor(o/50)+1;if(r>0&&r<=this.widthPin)return{pin:r,info:this.pinDescription[r]}}calculateDistance(n,o,r,c){const s=r-n,l=c-o;return Math.sqrt(s*s+l*l)}rotate(){const n=this.widthPin;this.widthPin=this.heightPin,this.heightPin=n}};let d=C;h(d,"IC_CONTAINER",[]);d.add(new d(4,4,{},"IC-8Pin"));d.add(new d(4,6,{},"IC-12Pin"));d.add(new d(4,7,{},"IC-14Pin"));d.add(new d(4,8,{},"IC-16Pin"));d.add(new d(4,9,{},"IC-18Pin"));const z=new d(3,6,{1:"Vcc",2:"Gnd",3:"input",4:"output"},"Demo");d.add(z);function _(t){const n=d.IC_CONTAINER.find(o=>o.id==t);n||console.error(`Ic with id: ${t}not found`),console.log("selected ic is",n),e.selectedIc=n}window.selectIc=_;const $=a.getSafeHtmlElement("saveProjectBtn");$.addEventListener("click",function(){const t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(S())),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","canvas_project.json"),document.body.appendChild(n),n.click(),n.remove()});function S(){return{dots:e.dots,lines:e.lines,canvas:{width:i.c.width,height:i.c.height},ICs:d.IC_CONTAINER||[]}}const J=a.getSafeHtmlElement("saveProgressBtn");J.addEventListener("click",function(){localStorage.setItem("save",JSON.stringify(S())),alert("Project saved to local storage.")});function L(){i.ctx.fillStyle=e.canvasBackgroundColor,i.ctx.clearRect(0,0,i.c.width,i.c.height),i.ctx.fillRect(0,0,i.c.width,i.c.height),i.ctx.fill()}function U(t){i.ctx.beginPath(),i.ctx.arc(t.x,t.y,e.dotRadius,0,Math.PI*2),i.ctx.fillStyle=t.color,i.ctx.fill(),t==e.selectedDot&&(i.ctx.strokeStyle="#00f",i.ctx.lineWidth=5,i.ctx.stroke()),t==e.hoverDot&&(i.ctx.strokeStyle="#8a8a8a",i.ctx.lineWidth=5,i.ctx.stroke());for(const n of d.IC_CONTAINER)if(n.getPinPositionOnIC(t)){const o=n.getPinPositionOnIC(t);i.ctx.fillStyle="#e8b0b0",i.ctx.font="10px Arial",i.ctx.fillText(((o==null?void 0:o.pin)+" "+((o==null?void 0:o.info)||"")||"n").substring(0,5),t.x,t.y+e.dotRadius+10),i.ctx.fill()}t.description&&(i.ctx.font="10px Arial",i.ctx.textAlign="center",i.ctx.fillStyle=t.color,t==e.hoverDot?i.ctx.fillText(t.description,t.x,t.y+e.dotRadius+10):i.ctx.fillText(t.description.substring(0,5),t.x,t.y+e.dotRadius+10))}function Y(t){i.ctx.beginPath(),i.ctx.moveTo(t.start.x,t.start.y),i.ctx.lineTo(t.end.x,t.end.y),i.ctx.strokeStyle=t.color,i.ctx.lineWidth=t==e.selectedLine?5:t==e.hoverLine?4:3,i.ctx.stroke()}function u(){L();for(const t of d.IC_CONTAINER)t.draw();for(let t=0;t<e.dots.length;t++)U(e.dots[t]);for(let t=0;t<e.lines.length;t++)Y(e.lines[t])}window.addEventListener("keydown",t=>{console.log(t);for(const n of m.sohortcuts)t.key==n.key&&t.ctrlKey==!!n.ctrl&&n.event(t)});class m{static add(n){this.sohortcuts.find(o=>n.key==o.key)!==void 0&&console.warn(`Shortcut key: ${n.key} already exists`),this.sohortcuts.push(n),this.show()}static show(){a.getSafeHtmlElement("shortcuts").innerHTML="<b>Shortcuts:</b> <br>"+this.sohortcuts.map(n=>`key: <b>${n.ctrl?"ctrl + ":""} ${n.key} </b> - ${n.description}`).join("<br>")}}h(m,"sohortcuts",[]);i.c.addEventListener("mousedown",function(t){W(i.c,t),e.selectedIc&&(e.selectedIc=void 0)});function W(t,n){const o=t.getBoundingClientRect(),r=n.clientX-o.left,c=n.clientY-o.top;for(let s=0;s<e.dots.length;s++){const l=e.dots[s],f=r-l.x,g=c-l.y;if(f*f+g*g<e.dotSelectionRadius*e.dotSelectionRadius){if(e.selectedDot&&e.selectedDot!=l){const p={start:e.selectedDot,end:l,color:"#777676"};e.lines.push(p),e.changes.splice(e.changeIndex+1),e.changes.push({type:"add",line:p}),e.changeIndex++,e.selectedDot=void 0,e.selectedLine=p,u()}else e.selectedDot=l,e.selectedLine=void 0,u();return}}for(let s=0;s<e.lines.length;s++){const l=e.lines[s],f=l.start.x-r,g=l.start.y-c,p=l.end.x-r,x=l.end.y-c,v=Math.sqrt(f*f+g*g),D=Math.sqrt(p*p+x*x),I=Math.sqrt(Math.pow(l.end.x-l.start.x,2)+Math.pow(l.end.y-l.start.y,2));if(Math.abs(I-(v+D))<e.lineSelectTolerance){e.selectedLine=l,e.selectedDot=void 0,u();return}}e.selectedDot=void 0,e.selectedLine=void 0,u()}m.add({key:"Escape",description:"Unselect dot or line",event:()=>{e.selectedDot=void 0,e.selectedLine=void 0,e.selectedIc=void 0}});function F(t,n){const o=new n;return Object.assign(o,t),o}const b=a.getSafeHtmlElement("loadProjectBtn"),G=a.getSafeHtmlElement("loadProjectTrigger");G.addEventListener("click",function(){b.click()});b.addEventListener("change",function(t){const n=t.target.files[0];if(!n)return;const o=new FileReader;o.onload=function(r){const c=r.target.result,s=JSON.parse(c);N(s),u()},o.readAsText(n)});function N(t){i.c.width=t.canvas.width,i.c.height=t.canvas.height,e.dots=t.dots,e.lines=t.lines,d.IC_CONTAINER=t.ICs.map(n=>F(n,d)),console.log(d.IC_CONTAINER),d.showICs()}i.c.addEventListener("mousemove",function(t){var c;const n=i.c.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top;e.hoverDot=void 0;for(let s=0;s<e.dots.length;s++){const l=e.dots[s],f=o-l.x,g=r-l.y;if(f*f+g*g<e.dotSelectionRadius*e.dotSelectionRadius){e.hoverDot=l;break}}e.hoverLine=void 0;for(let s=0;s<e.lines.length;s++){const l=e.lines[s],f=l.start.x-o,g=l.start.y-r,p=l.end.x-o,x=l.end.y-r,v=Math.sqrt(f*f+g*g),D=Math.sqrt(p*p+x*x),I=Math.sqrt(Math.pow(l.end.x-l.start.x,2)+Math.pow(l.end.y-l.start.y,2));if(Math.abs(I-(v+D))<e.lineSelectTolerance){e.hoverLine=l;break}}u();for(const s of d.IC_CONTAINER)s.id==((c=e.selectedIc)==null?void 0:c.id)&&s.updatePosition(o,r);e.hoverDot&&e.hoverDot.description?a.getSafeHtmlElement("dotDescription").innerText=e.hoverDot.description:a.getSafeHtmlElement("dotDescription").innerText=""});m.add({key:"m",description:"Move the point. select a point, then move the mouse pointer to another point, then press 'm'",event:()=>{!e.hoverDot||!e.selectedDot||(e.dots=e.dots.map(t=>{var n,o,r,c;return t.x==((n=e==null?void 0:e.hoverDot)==null?void 0:n.x)&&t.y==((o=e.hoverDot)==null?void 0:o.y)?{...e.selectedDot,x:t.x,y:t.y}:t.x==((r=e==null?void 0:e.selectedDot)==null?void 0:r.x)&&t.y==((c=e.selectedDot)==null?void 0:c.y)?{description:void 0,color:void 0,x:t.x,y:t.y}:t}),e.selectedDot=void 0)}});a.getSafeHtmlElement("addDescriptionBtn").addEventListener("click",function(){R()});a.getSafeHtmlElement("deleteDescriptionBtn").addEventListener("click",function(){O()});function R(){if(e.selectedDot){const t=prompt("Enter a description for the dot");e.selectedDot.description=t,e.selectedDot=void 0,u()}else alert("Please select a dot first by clicking on it")}function O(){e.selectedDot?(e.selectedDot.description=null,u()):alert("Please select a dot first by clicking on it")}m.add({key:"d",event:R,description:"Add description."});m.add({key:"D",event:O,description:"Remove description."});a.getSafeHtmlElement("changeDotColorBtn").addEventListener("click",function(){H()});function H(){!e.selectedDot||(a.getSafeHtmlElement("colorPicker").onchange=function(){e.selectedDot&&(e.selectedDot.color=this.value,u())},a.getSafeHtmlElement("colorPicker").click())}a.getSafeHtmlElement("changeLineColorBtn").addEventListener("click",function(){T()});a.getSafeHtmlElement("deleteLineBtn").addEventListener("click",function(){M()});function T(){!e.selectedLine||(a.getSafeHtmlElement("colorPicker").onchange=function(){e.selectedLine&&(e.selectedLine.color=this.value,u())},a.getSafeHtmlElement("colorPicker").click())}function M(){if(e.selectedLine){const t=e.lines.indexOf(e.selectedLine);t>-1&&(e.changes.splice(e.changeIndex+1),e.changes.push({type:"remove",line:e.selectedLine}),e.changeIndex++,e.lines.splice(t,1),e.selectedLine=void 0,u())}else alert("Please select a line first by clicking on it")}m.add({key:"Delete",event:M,description:"Delete line."});m.add({key:"c",event:()=>{T(),H()},description:"Change dot/line color."});a.getSafeHtmlElement("backBtn").addEventListener("click",function(){B()});function B(){if(e.changeIndex>=0){const t=e.changes[e.changeIndex];if(t.type=="add"){for(let n=0;n<e.lines.length;n++)if(e.lines[n].start==t.line.start&&e.lines[n].end==t.line.end){e.lines.splice(n,1);break}}else t.type=="remove"&&e.lines.push(t.line);e.changeIndex--,u()}}a.getSafeHtmlElement("forwardBtn").addEventListener("click",function(){A()});function A(){if(e.changeIndex<e.changes.length-1){e.changeIndex++;const t=e.changes[e.changeIndex];if(t==null)return;if(t.type=="add")e.lines.push(t.line);else if(t.type=="remove"){for(let n=0;n<e.lines.length;n++)if(e.lines[n].start==t.line.start&&e.lines[n].end==t.line.end){e.lines.splice(n,1);break}}u()}}m.add({key:"z",ctrl:!0,description:"Undo last change.",event:B});m.add({key:"y",ctrl:!0,description:"Redo last undo.",event:A});window.addEventListener("DOMContentLoaded",()=>{if(localStorage.getItem("save")!==null)try{console.log("loaad...");const t=JSON.parse(localStorage.getItem("save"));N(t),u()}catch(t){console.error(t),console.log("Cant load save from local storage.")}});const E=a.getSafeHtmlElement("dotMatrixWidth"),w=a.getSafeHtmlElement("dotMatrixHeight"),X=a.getSafeHtmlElement("resizeGridBtn");X.addEventListener("click",function(){const t=parseInt(E.value),n=parseInt(w.value);k(t,n),e.lines=[],u()});function k(t,n){i.c.width=t*50,i.c.height=n*50;const o=i.c.width/t,r=i.c.height/n;e.dots=[];for(let c=o/2;c<i.c.width;c+=o)for(let s=r/2;s<i.c.height;s+=r)e.dots.push({x:c,y:s,description:null,color:"#a4a0a0"})}a.getSafeHtmlElement("resetBtn").addEventListener("click",function(){e.lines=[],e.dots=[],d.IC_CONTAINER=[],localStorage.setItem("save",void 0),k(parseInt(E.value||"10"),parseInt(w.value||"10")),L(),u()});k(parseInt(E.value||"10"),parseInt(w.value||"10"));L();u();
